<!DOCTYPE html>
<html lang="en">
<head>
    {% if args.title.as_ref().is_none() %}
    <title>MicroBin</title>
    {%- else %}
    <title>{{ args.title.as_ref().unwrap() }}</title>
    {%- endif %}

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Modern, fast, and secure pastebin service">
    <link rel="icon" type="image/svg+xml" href="{{ args.public_path_as_str() }}/static/favicon.ico">

    <!-- 现代化样式 -->
    {% if !args.pure_html %}
        {% if args.custom_css.as_ref().is_none() || args.custom_css.as_ref().unwrap() == "" %}
            <link rel="stylesheet" href="{{ args.public_path_as_str() }}/static/modern.css">
        {%- else %}
            <link rel="stylesheet" href="{{ args.custom_css.as_ref().unwrap() }}">
        {%- endif %}
    {%- endif %}

    <!-- JavaScript for enhanced functionality -->
    <script type="text/javascript" src="{{ args.public_path_as_str() }}/static/aes.js"></script>
    
    <!-- 现代化交互脚本 -->
    <script>
        // 页面加载动画
        document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('fade-in');
            
            // 表单提交加载状态
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = form.querySelector('input[type="submit"], button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.classList.add('loading');
                        submitBtn.disabled = true;
                    }
                });
            });
            
            // 文件拖拽上传
            const fileLabel = document.getElementById('attach-file-button-label');
            const fileInput = document.getElementById('file');
            
            if (fileLabel && fileInput) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    fileLabel.addEventListener(eventName, preventDefaults, false);
                });
                
                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }
                
                ['dragenter', 'dragover'].forEach(eventName => {
                    fileLabel.addEventListener(eventName, highlight, false);
                });
                
                ['dragleave', 'drop'].forEach(eventName => {
                    fileLabel.addEventListener(eventName, unhighlight, false);
                });
                
                function highlight(e) {
                    fileLabel.style.borderColor = 'var(--primary-color)';
                    fileLabel.style.background = 'var(--primary-light)';
                }
                
                function unhighlight(e) {
                    fileLabel.style.borderColor = 'var(--border-color)';
                    fileLabel.style.background = 'var(--background-body)';
                }
                
                fileLabel.addEventListener('drop', handleDrop, false);
                
                function handleDrop(e) {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    
                    if (files.length > 0) {
                        fileInput.files = files;
                        updateFileLabel(files[0].name);
                    }
                }
                
                fileInput.addEventListener('change', function() {
                    if (this.files.length > 0) {
                        updateFileLabel(this.files[0].name);
                    }
                });
                
                function updateFileLabel(fileName) {
                    fileLabel.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                            </svg>
                            <span>${fileName}</span>
                        </div>
                    `;
                }
            }
            
            // 自动调整textarea高度
            const textareas = document.querySelectorAll('textarea');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = this.scrollHeight + 'px';
                });
            });
        });
        
        // 复制功能增强
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(function() {
                const originalText = button.textContent;
                button.textContent = '✓ Copied!';
                button.classList.add('btn-success');
                
                setTimeout(function() {
                    button.textContent = originalText;
                    button.classList.remove('btn-success');
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy: ', err);
            });
        }
    </script>
</head>

<body class="container">
    {% if !args.hide_header %}
    <nav id="nav">
        <div style="display: flex; align-items: center;">
            {% if !args.hide_logo %}
            <a href="{{ args.public_path_as_str() }}/" style="display: flex; align-items: center; text-decoration: none;">
                <img src="{{ args.public_path_as_str() }}/static/logo.png" alt="MicroBin Logo">
                {% if args.title.as_ref().is_some() %}
                <span style="font-weight: 600; font-size: 1.25rem; color: var(--text-primary);">
                    {{ args.title.as_ref().unwrap() }}
                </span>
                {% else %}
                <span style="font-weight: 600; font-size: 1.25rem; color: var(--text-primary);">
                    MicroBin
                </span>
                {%- endif %}
            </a>
            {%- endif %}
        </div>
        
        <div style="display: flex; gap: var(--spacing-sm); flex-wrap: wrap;">
            <a href="{{ args.public_path_as_str() }}/">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20" style="margin-right: 0.25rem;">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                </svg>
                New
            </a>
            
            {% if !args.no_listing %}
            <a href="{{ args.public_path_as_str() }}/list">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20" style="margin-right: 0.25rem;">
                    <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                </svg>
                List
            </a>
            {%- endif %}
            
            <a href="{{ args.public_path_as_str() }}/guide">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20" style="margin-right: 0.25rem;">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"></path>
                </svg>
                Guide
            </a>
        </div>
    </nav>
    {%- endif %}
    
    <main>
