{% include "modern_header_enhanced.html" %}

<!-- Pasta信息卡片 -->
<div class="card">
    <div class="card-header">
        <div class="flex justify-between items-start gap-4">
            <div>
                <h1 class="card-title">
                    {% if pasta.custom_path.is_some() %}
                    {{ pasta.custom_path.as_ref().unwrap() }}
                    {% else %}
                    Pasta {{ pasta.id_as_animals() }}
                    {%- endif %}
                </h1>
                <div class="flex items-center gap-4 text-sm text-secondary mt-2">
                    <span class="flex items-center gap-1">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path>
                        </svg>
                        Created {{ pasta.created_as_string() }}
                    </span>
                    {% if pasta.expiration != 0 %}
                    <span class="flex items-center gap-1">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                        </svg>
                        Expires {{ pasta.expiration_as_string() }}
                    </span>
                    {%- endif %}
                    {% if pasta.burn_after != 0 %}
                    <span class="flex items-center gap-1">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"></path>
                        </svg>
                        Burns after {{ pasta.burn_after }} reads
                    </span>
                    {%- endif %}
                </div>
            </div>
            
            <!-- 操作按钮 -->
            <div class="action-buttons">
                {% if pasta.pasta_type == "url" %}
                <button id="copy-redirect-button" class="btn btn-outline btn-sm" onclick="copyToClipboard(redirect_url, this)">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5z"></path>
                        <path d="M7.414 15.414a2 2 0 01-2.828-2.828l3-3a2 2 0 012.828 0 1 1 0 001.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5z"></path>
                    </svg>
                    Copy Redirect
                </button>
                {%- endif %}
                
                <a href="/raw/{{pasta.get_path()}}" class="btn btn-outline btn-sm">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L15 13.586V12a1 1 0 011-1z" clip-rule="evenodd"></path>
                    </svg>
                    Raw
                </a>
                
                {% if args.qr %}
                <a href="/qr/{{pasta.get_path()}}" class="btn btn-outline btn-sm">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 4a1 1 0 000 2v9a2 2 0 002 2h1a1 1 0 100-2H5V6a1 1 0 01-1-1V4a1 1 0 01-1-1zm3 1h2v2H6V5zm0 4h2v2H6V9zm2 4H6v2h2v-2zm2-8h2v2h-2V5zm0 4h2v2h-2V9zm2 4h-2v2h2v-2zm2-8h2v2h-2V5zm0 4h2v2h-2V9zm2 4h-2v2h2v-2z" clip-rule="evenodd"></path>
                    </svg>
                    QR Code
                </a>
                {%- endif %}
                
                {% if pasta.editable %}
                <a href="/edit/{{pasta.get_path()}}" class="btn btn-outline btn-sm">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"></path>
                    </svg>
                    Edit
                </a>
                {%- endif %}
                
                <a href="/remove/{{pasta.get_path()}}" class="btn btn-outline btn-sm" style="color: var(--color-error); border-color: var(--color-error);">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" clip-rule="evenodd"></path>
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                    </svg>
                    Remove
                </a>
                
                <button id="copy-url-button" class="btn btn-primary btn-sm" onclick="copyToClipboard(url, this)">
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path>
                        <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path>
                    </svg>
                    Copy URL
                </button>
            </div>
        </div>
    </div>

    <!-- 内容区域 -->
    {% if pasta.content != "" %}
    <div class="mb-6">
        {% if pasta.pasta_type == "url" %}
        <!-- URL类型显示 -->
        <div class="p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
            <div class="flex items-center gap-3 mb-3">
                <svg width="24" height="24" fill="currentColor" viewBox="0 0 20 20" class="text-blue-600">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5z" clip-rule="evenodd"></path>
                    <path d="M7.414 15.414a2 2 0 01-2.828-2.828l3-3a2 2 0 012.828 0 1 1 0 001.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5z"></path>
                </svg>
                <h3 class="text-lg font-semibold text-blue-900">Redirect URL</h3>
            </div>
            <a href="{{ pasta.content }}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 font-medium break-all">
                {{ pasta.content }}
            </a>
        </div>
        {% else %}
        <!-- 文本内容显示 -->
        <div class="relative">
            <div class="flex justify-between items-center mb-3">
                <h3 class="text-lg font-semibold">Content</h3>
                <div class="flex items-center gap-2">
                    {% if pasta.highlight_language.is_some() %}
                    <span class="px-2 py-1 bg-primary-100 text-primary-800 rounded-md text-xs font-medium">
                        {{ pasta.highlight_language.as_ref().unwrap() }}
                    </span>
                    {%- endif %}
                    <button id="copy-text-button" class="btn btn-outline btn-sm" onclick="copyToClipboard(content, this)">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path>
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path>
                        </svg>
                        Copy Text
                    </button>
                </div>
            </div>
            
            <div class="code-block">
                <pre id="code" class="language-{{ pasta.highlight_language.as_ref().unwrap_or(&String::from("text")) }}"><code>{{ pasta.content }}</code></pre>
            </div>
        </div>
        {%- endif %}
    </div>
    {%- endif %}

    <!-- 文件信息 -->
    {% if pasta.file.is_some() %}
    <div class="mb-6">
        <h3 class="text-lg font-semibold mb-3 flex items-center gap-2">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
            </svg>
            Attached File
        </h3>
        
        <div class="p-4 border border-primary rounded-lg bg-primary-light">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-primary-500 rounded-lg flex items-center justify-center">
                        <svg width="20" height="20" fill="white" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                        </svg>
                    </div>
                    <div>
                        <div class="font-medium">{{ pasta.file.as_ref().unwrap().name }}</div>
                        <div class="text-sm text-secondary">{{ pasta.file.as_ref().unwrap().size }} bytes</div>
                    </div>
                </div>
                
                <a href="/file/{{pasta.id_as_animals()}}/{{ pasta.file.as_ref().unwrap().name }}" class="btn btn-primary btn-sm" download>
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                    </svg>
                    Download
                </a>
            </div>
        </div>
    </div>
    {%- endif %}
</div>

<!-- 语法高亮 -->
{% if args.highlightsyntax %}
<script type="text/javascript" src="/static/highlight/highlight.min.js"></script>
<link rel="stylesheet" href="/static/highlight/highlight.min.css">
<script>
    document.addEventListener('DOMContentLoaded', function() {
        hljs.highlightAll();
    });
</script>
{%- endif %}

<!-- 页面脚本 -->
<script>
    // 动态获取基础URL
    const getBaseUrl = () => {
        const publicPath = `{{ args.public_path_as_str() }}`;
        const shortPath = `{{ args.short_path_as_str() }}`;
        
        if (shortPath !== "") {
            return shortPath;
        } else if (publicPath !== "") {
            return publicPath;
        } else {
            return window.location.origin;
        }
    };
    
    const baseUrl = getBaseUrl();
    const url = `${baseUrl}/{{pasta.get_path()}}`;
    const redirect_url = (`{{ args.short_path_as_str()}}` === "") ? `${baseUrl}/url/{{pasta.id_as_animals()}}` : `{{ args.short_path_as_str()}}/u/{{pasta.id_as_animals()}}`;
    const content = `{{ pasta.content }}`;
    
    // 页面加载完成后添加动画
    document.addEventListener('DOMContentLoaded', function() {
        // 为代码块添加行号
        const codeElement = document.getElementById('code');
        if (codeElement && codeElement.textContent.split('\n').length > 1) {
            addLineNumbers(codeElement);
        }
        
        // 添加复制功能到代码块
        addCopyButtonToCodeBlock();
    });
    
    function addLineNumbers(codeElement) {
        const lines = codeElement.textContent.split('\n');
        const lineNumbersWrapper = document.createElement('div');
        lineNumbersWrapper.className = 'line-numbers';
        lineNumbersWrapper.style.cssText = `
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3rem;
            background: var(--bg-elevated);
            border-right: 1px solid var(--border-primary);
            padding: var(--space-6) var(--space-2);
            font-family: var(--font-family-mono);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-relaxed);
            color: var(--text-tertiary);
            user-select: none;
        `;
        
        for (let i = 1; i <= lines.length; i++) {
            const lineNumber = document.createElement('div');
            lineNumber.textContent = i;
            lineNumbersWrapper.appendChild(lineNumber);
        }
        
        const codeBlock = codeElement.closest('.code-block');
        codeBlock.style.position = 'relative';
        codeBlock.style.paddingLeft = '4rem';
        codeBlock.insertBefore(lineNumbersWrapper, codeElement);
    }
    
    function addCopyButtonToCodeBlock() {
        const codeBlock = document.querySelector('.code-block');
        if (codeBlock) {
            const copyButton = document.createElement('button');
            copyButton.className = 'btn btn-outline btn-sm';
            copyButton.style.cssText = `
                position: absolute;
                top: var(--space-3);
                right: var(--space-3);
                z-index: 10;
            `;
            copyButton.innerHTML = `
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z"></path>
                    <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3H9a3 3 0 01-3-3z"></path>
                </svg>
                Copy
            `;
            copyButton.onclick = () => copyToClipboard(content, copyButton);
            
            codeBlock.style.position = 'relative';
            codeBlock.appendChild(copyButton);
        }
    }
</script>

{% include "modern_footer_enhanced.html" %}
